
# 1 그레이들의 기본을 이해

## 1.1 그레이들 특징

### 스크립트로 기술 가능

- `그루비` 라는 스크립트 언어로 기술 가능
- 자바처럼 기술 가능, 더 간결하게 기술 가능

### 다른 환경에서 똑같이 실행 가능

- GradleWrapper 사용 시 설정된 버전으로 자동으로 셋업 가능
- 프로젝트팀 간이나 서버에서 같은 버전의 그레이들로 빌드 실행 가능

### 의존 관계 기술

- 한 줄만 써도 라이브러리 등을 추가 할 수 있다

```
dependencies{
    implementation 'com.android.support:design:23.1.1'
}
```

## 1.2 Android Gradle 플러그인의 특징

### 앱에 특화된 설정

- 앱의 버전 기술, 빌드에 이용한 툴의 버전 지정
- 빌드 변형 기능으로 제품 특성에 따른 앱을 만들 수 있다(ex 무료 버전과 유료 버전/ 디버그 버전과 릴리스 버전)

### 안드로이드 스튜디오와의 결합

- 안드로이드 스튜디오는 그레이들로 앱을 빌드

## 1.3 안드로이드 빌드 파일

- 루트 프로젝트 안에 app 모듈 
- 모듈 : 그레이들의 개념으로서는 프로젝트
- 프로젝트 : build.gradle을 가진다
- 루트 프로젝트와 app 프로젝트는 기본적으로 2개의 build.gradle

###  프로젝트의 build.gradle

- 리포지토리 지정
- 빌드 시 의존관계 지정
- 각 프로젝트의 리포지토리 지정

## 1.4 모듈의 build.gradle

빌드에 필요한 앱의 설정 등을 기술하는 빌드 스크립트

- Android Gradle 플러그인 적용
- Android Gradle 플러그인에서 이용되는 Android 블록
- 앱 자체의 설정
- libs 디렉터리에 있는 jar파일을 읽어온다
- 의존관계

### setting.gradle

- 어떤 모듈이 있는지 기술

### Gradle Wrapper 설정

- 필요한 그레이들이 설치돼 있지 않아도 실행할 수 있고, 팀으로 개발할 때 모두 같은 환경에서 빌드 할 수 있다

### 프로가드 설정

- 빌드 시 코드를 난독화하거나 최적화하는 도구
- 빌드 시 사용하지 않는 메서드는 지워준다
- 난독화 :디컴파일해서 apk로부터 소스코드를 쉽게 읽어내는 행위를 막을 수 있다

### 그레이들 표준 프로퍼티 파일

- build.gradle에서 참조 가능한 파일

### SDK위치를 저장하는 프로퍼티 파일

- SDK 위치가 적혀있다

## 1.5 그레이들의 테스크

- 그레이들이 빌드할 때 '태스크'가 빌드 처리를 수행
- 실행 버튼 - Android Gralde 플러그인이 정의하는 assembleDebug라는 태스크를 실행

-------------------------------

# 2 Android Gradle 플러그인의 설정

- 유료 버전과 무료 버전으로 앱을 만들 때 효율적으로 만들 수 있다
- 빌드 타킷이나 컴파일 시 이용하는 SDK 등을 설정할 수 있다

## 2.1 그레이들에서 설정하는 안드로이드 앱 설정

### 1) 컴파일 시에 이용하는 SDK 버전 : compileSdkVersion

- 컴파일 시 이용
- 안드로이드 앱의 소스코드인 자바 파일을 컴파일해서 class 파일로 만들 때 이용
- 예를 들어
```
API Level 21(안드로이드 5.0)부터 추가된 메서드를 이용하고,
compileSdkVersion을 19로 지정한 경우 
- 메서드가 존재하지 않는다는 오류가 나서 빌드 불가

*  지원 라이브러리도 compileSdkVersion에 의존하므로 버전을 맞춰줘야 할 필요가 있다
```

### 2) 빌드 툴 버전 : buildToolsVersion

- 컴파일 시 이용
- 어느 빌드 툴 버전을 이용할지 설정
- 최신 버전으로 해두는 편이 좋다

### 3) 서명을 설정 : signingConfigs

- keystore 파일의 경로와 패스워드 등을 설정
- 디지털 서명에 필요한 인증서가 저장

### 4) 앱의 패키지명 : applicationId

- defaultConfig 블록 안에 정의
- 앱의 패키지명 설정

### 5) 최소 SDK 버전 : minSdkVersion

- 앱을 설치할 수 있는 최소 API 레벨 지정

### 6) 타킷이 될 SDK 버전 : targetSdkVersion

- 실제 안드로이드 단말기 상에 존재하는 안드로이드 API의 구현 안에는 targetSdkVersion을 보고 처리를 나누는 부분이 많이 있다
- 단말기 상의 구현 예

```
if(targetSdkVersion이 19 이상인 경우){
    // 19 이상인 경우 처리
} else{
    // 19 미만인 경우 처리
}
```

- OS가 바뀌어 동작이 변했을 때 앱이 동작하지 않게 되는 것을 방지하기 위한 것

### 7) 버전 설정

- 버전 코드는 숫자로 기술하고 버전 네임은 문자열로 기술
- 안드로이드 앱을 업데이트 하기 위해서는 버전 코드를 변경할 필요가 있다

## 2.2 상황에 맞게 프로젝트를 커스터마이징

- 유료 버전과 무료 버전으로 앱을 만들 경우 앱을 갱신할 때마다 각각 코드와 문자열을 수정하려면 시간이 많이 걸린다
- 디버그 빌드일 때 Web API의 참조를 테스트용 환경으로 사용하고 싶은 경우도 있다
- 테스크의 목 등에서도 이용 가능

### 빌드 타입

- 그레이들에는 빌드별로 설정할 수 있는 빌드 타입이 있다
- 가장 많이 이용되는 빌드 타입 : debug, release
- debug 에는 apk에 디버그 서명이 돼 있고, release에는 릴리스 서명이 되있다
- 디버그 서명으로는 디버그하고, 릴리스 서명으로 Google Play에 릴리스

### 프로덕트 플레이버

- 디버그 등의 빌드 타입이 아니라 구현자체를 바꾸거나 별도의 apk를 만들고 싶을 때 이용
- 예를 들어) 무료 버전과 유료 버전의 앱을 만들 때

```
android{
    productFlavors{
        pro{
        }
        free{
        }
    }
}

```

-------------------------------

## 3 커맨드라인으로 실행

### 3.1 커맨드라인에서 실행 장점

- 서버 상에서 빌드 가능

CI 서버 등의 서버 상에서 빌드를 실행 가능

- 상세한 정보를 볼 수 있다

프로젝트에 포함되는 모듈의 정보 목록 확인이나 의존관계 확인 등 다양한 정보

- 빌드 중 발생한 문제를 파악할 수 있게 된다

디버그 로그가 출력되어 해결의 실마리를 찾을 수 있다

### 3.2 빌드

- 터미널에서 빌드
```
./gradlew assembleDebug
```

- 터미널에서 릴리스 빌드
```
./gradlew assembleRelease
```

### 3.3 응용 조작

#### 그레이들 설정

- 두 가지 편리한 설정

#### BuildConfig 클래스에 필드 추가

- 빌드 시 앱에서 사용할 수 있는 플래그 등의 설정을 추가

#### 버전 설정 등의 설정 항목을 모아 기술

- 버전 코드를 공통화해서 기술 가능

#### 커맨드 라인

- 그레이들의 태스크를 생략하고 실행

#### 빌드를 디버그

- 상세한 로그 출려과 직접적인 빌드 실패 이유가 출력

#### 파라미터 조작

- build.gradle에서 이용하는 변수로 만들 수 있다

#### 모듈의 의존관계를 확인

- 자신이 어느 라이브러리를 사용하는지 등의 의존관계를 확인 가능
- 오픈소스 라이브러리에서 무엇을 사용하는지 확인 가능
- 각 라이브러리가 이용하는 버전을 확인 가능

#### 짧게 줄여 태스크 실행

- 시간이 절약되고 재빠르게 실행 가능
